# `GLOBALS` module functions

| function | env | parameters | description |
|----------|-----|------------|-------------|
| curlsend | php | address, data, timeout, content, curlopts | Executes an HTTP request using cURL. If the data parameter is provided, the request will be POST; otherwise, it will be GET. The data content is converted using the function specified in content (such as http_build_query or json_encode). Sets default cURL options unless overridden via curlopts, including headers, SSL verification, redirection, user-agent, and timeouts. Returns the response content as text. |
| module_exists | php | ...$params | Checks if one or more modules (classes, traits, or static methods) exist. Accepts multiple parameters, which can be method names in the format 'Class::method' or class/trait names. Parses and sanitizes the strings and uses method_exists, class_exists, and trait_exists for confirmation. Returns true if all modules are found. |
| listmodules | php | path, &modules | Recursively lists all PHP files in a directory and its subdirectories, adding the names (without extension and with non-alphabetic characters removed) to the $modules array. By default, starts at REPODIR/resources/. Returns the array of found modules. |
| jwt_encode | php | payload, header, secret | Generates a JWT token signed with HMAC. The payload and header are encoded in base64 URL-safe. The algorithm is defined via header (e.g., HS512) and the secret is obtained automatically via $\_SERVER or passed manually. Includes the iat (issued at) field in the payload. Returns the complete JWT string. |
| jwt_decode | php | hash, secret | Decodes and validates a JWT token. If the prefix "jwt." is present, it is removed. Checks the token's integrity by comparing it with a new signature generated from the extracted payload and header. Uses the same secret as in generation. Returns an array with 'header' and 'payload' if valid, or an empty array if invalid. |
| base32Decode | php | input | Decodes a string encoded in Base32 (TOTP/2FA standard). Converts the characters into 5-bit bits, groups into bytes, and converts to ASCII characters. Returns the original string if valid or false in case of error. |
| base32Encode | php | data | Encodes a binary string into Base32 format (TOTP/2FA standard). Converts each byte to bits, divides into groups of 5 bits, and maps using the Base32 alphabet. Returns the encoded string. |
| validatearray | php | array | Ensures that the received value is returned as an array. If it is an object, tries to convert it with json_encode followed by json_decode. If conversion is not possible, returns an empty array. |
| recursiveksort | php | &array | Recursively sorts all keys of a multidimensional array using ksort. Modifies the original array by reference and returns the result of the root sorting. |
| useragent | php | includepush | Returns the HTTP_USER_AGENT value from the server, if available. Otherwise, generates a generic user-agent based on IP, gateway, charset, and server signature. If includepush is true and there is a pushid in the request, includes it. |
| isplatform | php | name | Checks if the value of the constant $\_SERVER\['PLATFORM'\] is equal to the provided parameter. Returns true or false. |
| filtereduseragent | php | str, level, match | Generates a simplified and filtered version of the current or provided user-agent, removing or replacing parts based on filtering options defined by match. The result is limited to a number of fragments determined by level. |
| setconfig | php | key, value | Saves a global configuration with key and value in $\_SERVER\['configs'\] and in the global_configs table in the database. The value is sanitized according to its type before being persisted. Returns the saved value or null in case of failure. |
| getconfig | php | key, def, savedef | Retrieves a configuration from the $\_SERVER\['configs'\] cache or from the database. If the key does not exist and def is provided, sets it in the cache and database (if savedef is true). Returns the found value or def. |
| delcookie | php | key | Removes a cookie with the given name by setting a past expiration and removing it from the $\_COOKIE array. Returns an empty string. |
| savecookie | php | key, cvalue, tempo | Saves a cookie with the given key and value. If tempo is 'auto', sets expiration to 1 year. Removes the previous cookie, if it exists. Returns the saved value. |
| getcontrastcolor | php | hexcolor | Calculates the ideal contrast color (black or white) for the background with the given hexadecimal color, based on the YIQ value. Returns '#333333' for light backgrounds or '#f6f6f6' for dark ones. |
| mergearrays | php | a1, a2, priorfirst, &instant | Merges two arrays. If priorfirst is false, values from a2 overwrite a1. If priorfirst is true, a1 has priority. The resulting array can be assigned by reference to the instant variable. Returns the final combined array. |
| remainingstr | php | value1, value2, format | Calculates the remaining time between two timestamps and returns a formatted string according to the placeholders defined in format. Supports days, hours, minutes, and seconds, with pluralization. |
| datetostrtotime | php | date, dmyonly | Converts date strings or timestamps to a format compatible with strtotime. Parses and adjusts the format (including dd/mm/yyyy to yyyy-mm-dd). If dmyonly is true, omits the time. Returns the formatted string. |
| str_maskmiddle | php | input | Masks approximately 30% of the central alphanumeric characters of a string with '\*', preserving the ends. Returns the string with the central part hidden. |
| str_maskmiddle_array | php | array, onlykeys | Recursively applies the str_maskmiddle function to all string values in an array (or only to the keys defined in onlykeys). Returns the array with masked values. |
| ucstrname | php | string, delimiters, exceptions | Formats Portuguese proper names with correct capitalization, keeping exceptions (like "de", "da", "LTDA") lowercase or uppercase as appropriate. Returns the formatted name. |
| floatval_safe | php | number, decimals | Safely converts a numeric string to float, removing invalid characters and keeping the precision defined by decimals. Returns the formatted float. |
| rmA | php | string | Removes accents from a string by converting accented characters to their basic forms (without accent). Returns the string without accents. |
| rmAentities | php | string | Converts special HTML characters to their normal equivalents, such as '\<' to '\<'. Returns the decoded string. |
| remote_addr | php | default | Returns the user's real IP, considering headers like HTTP_CF_CONNECTING_IP and HTTP_X_FORWARDED_FOR. If not found, returns the default value. |
| isbrazil | php | N/A | Checks if the user's IP starts with one of the typical Brazil prefixes. Returns true if yes, false otherwise. |
| haslang | php | language | Checks if the specified language is present in the browser's HTTP_ACCEPT_LANGUAGE. Returns true if matched. |
| like | php | needle, haystack | Implements an SQL LIKE-style comparison, converting '%' to regex and applying it to the haystack string. Returns true if matched. |
| decode_unicode | php | str | Converts unicode sequences in the format \\uXXXX to real UTF-8 characters. Performs iterative substitutions until decoding is complete. Returns the decoded string. |
| ordutf8 | php | string, &offset | Returns the ordinal code of a UTF-8 character from a specific position in the string, updating the offset to the next character. Supports up to 4 bytes per character. |
| unichr | php | u | Converts a Unicode code to the corresponding UTF-8 character using HTML entities. Returns the converted character. |
| emojientities | php | string | Converts special characters and emojis to safe HTML entities for display. Uses ordutf8 and unichr internally. Returns the string with applied entities. |
| html_tag_attrib | php | tag, attribute, html | Extracts the value of a specific attribute within an HTML tag. Returns the attribute value or an empty string if not found. |
| html_tag_content | php | tag, html | Extracts the textual content within a specific HTML tag. Returns the tag content or an empty string if not matched. |
| valida_cpf_cnpj | php | val | Validates CPF or CNPJ numbers based on structure and check digits. Returns true if valid and false if invalid. |
| formatar_cpf_cnpj | php | doc | Formats a CPF or CNPJ number to the Brazilian standard (with dots, slashes, and dash). Returns the formatted number or the original if invalid/incomplete. |
| markdowntohtml | php | markdown (string com marcações markdown) | Converts a Markdown string to HTML, processing headers, line breaks, code blocks (with syntax highlighting), tables, links, embedded images, lists, emphasis (bold, italic), and blockquotes. Recognizes - as a title separator, applies custom visual style, and handles code blocks delimited by \`\`\` with keyword highlighting and code structure. |
| .autouploadtosrc | js/class | element tags | JS function applied by class that automatically creates and links a hidden file input for elements with the .autouploadtosrc class, managing file uploads, displaying loading icons, base64 reading for fallback, and custom events autouploadtosrc_onstart and autouploadtosrc_ondone. Uses bindupload for sending and dynamically handles src attributes. |
| \[nextfield\] | js/attr | element tags | When pressing the Enter key (keycode 13) on an element with the nextfield attribute, focuses, clicks, or blurs the next field defined in the nextfield attribute, determining the event type based on the tag and type of the destination element. To focus on other elements, just pass the next field/button ID with # in front of the ID in the attribute, e.g.: `nextfield="#inputText"` |
| .btns, .btns2, .autolockbtn | js/class | element tags | Disables the button when clicked (unless it has .keepunlocked), preventing multiple clicks for 12,345 ms, re-enabling after that time. |
| .datamask | js/class | element tags | Automatically applies input mask for date format. |
| .cepmask | js/class | element tags | Automatically applies input mask for CEP format. |
| .telmask | js/class | element tags | Automatically applies input mask for phone format. |
| .cpfmask | js/class | element tags | Automatically applies input mask for CPF format. |
| .cnpjmask | js/class | element tags | Automatically applies input mask for CNPJ format. |
| .emailmask | js/class | element tags | Limits invalid characters, prevents spaces, and performs basic email structure validation on each key press and release. |
| .docmask | js/class | element tags | Dynamically switches mask between CPF and CNPJ according to the size and type of the entered document, handling keyup and keydown events for mask adjustment. |
| .cursorgrab | js/class | element tags | Allows dragging scrollable content horizontally and vertically with mouse down, move, and up, simulating "drag to scroll" behavior. |
| .horizontalscroll | css/class | element tags | Automatically adds to an element the capabilty of horizontal scrolling. |
| realignfooting | js/func | N/A | Dynamically adjusts the vertical position of the `.footing` element on the current screen. Removes inline styles and, via timer, reads the element's offset top to set `style="top:...px !important; bottom:auto;"`, ensuring correct alignment. |
| appscrolltobottom | js/func | N/A | Smoothly scrolls to the end of the `#app` container. Calculates the maximum page height and calls `scrollTo({ top, behavior: 'smooth' })`, returning true at the end. |
| animate_horizontalscroll | js/func | N/A | Animates a horizontal scroll in visible `.horizontalscroll` elements to indicate hidden content. Slides from right to left and displays an animated hand icon at the edge to instruct the user. |
| animation_execute | js/func | N/A | Iterates over elements with `data-animate` and adds the `.animate` class when they enter the viewport, removing it when they leave, to trigger animations based on visibility. |
| switchtab | js/func | to, backwards, params, stinterval | Performs animated switching between screens (`.screen`) identified by CSS ID (e.g., `#my_screen`): normalizes parameters, reads and saves the active screen name in `localStorage['screen']` (without `_uid` suffix to be global), hides the current screen and shows the new one with slide effect according to `backwards` and `stinterval`, triggers cycle events (`screen_onleft`, `switchtab`, `screen_onstart` before; `screen_onload`, `my_screen_onload`, `screen_onready` after), and updates the URL hash to `#my_screen[/params]`. The underline in the ID is kept to generate consistent event names and correctly map selector, state, and events. |
| getitem | js/func | qual, def | Reads the value from `localStorage` by the key `qual`; if not `screen` or `uid`, adds `_uid` suffix. Decodes JSON marked by `@array/object@` and returns `def` if absent. |
| setitem | js/func | qual, val | Writes `val` to `localStorage` under the key `qual`; if not `screen` or `uid`, adds `_uid` suffix. Serializes objects with `@array/object@` and handles quota errors by showing an alert. |
| eventfire | js/func | name, state | Fires a custom jQuery event `name` on the `window` object, attaching properties from `state` to the event and registering it in `eventlist`. |
| html_entity_decode | js/func | htmltext | Decodes HTML entities (`&`, `&#...;`) to plain text using an internal `<textarea>` element for conversion. |
| htmlentities | js/func | htmlstr, entquotes | Converts special characters in `` htmlstr `` to their numeric HTML entities. If `` entquotes `` is true, also encodes quotes (`` " ``, `` ' ``, `` ` ``). |
| savecookie | js/func | key, value, expiry, domain, path | Sets a cookie with name `key` and value `value`, configuring expiration in days (`expiry`), domain (`domain`), and path (`path`). Returns the saved value. |
| delcookie | js/func | key | Removes the `key` cookie by setting a past expiration on domain variations (hostname with and without dot) and default path. Returns true. |
| function\_exists | js/func | function\_name | Checks if `function_name` (string or reference) matches a function defined in `window` or is an instance of Function. Returns boolean. |
| curlsend | js/func | url, params, success, error, always, timeout, cachectl, reqtype, cors | Sends an AJAX GET or POST request to `url` with `params`, applying headers, content type (`reqtype`), cache (`cachectl`), and CORS. Triggers `success`, `error`, and `always` callbacks; fires events `${endpoint}_onpoststart` and `${endpoint}_onpostload`; manages cache in localStorage under `curl_cache_storage`; returns the jqXHR object of the call. |
| http\_build\_query | js/func | obj | Builds a URL-encoded query string from the `obj` object using `URLSearchParams`. |
| date | js/func | stringtxt, unixtimestamp, zone | Formats date/time according to `stringtxt` (e.g., 'Y-m-d H\:i\:s'), using Unix timestamp `unixtimestamp` and offset `zone`. Supports PHP-like tokens (`Y,y,m,d,H,i,s,P,w,W,D,M`). |
| empty | js/func | value, coalesce | Emulates PHP's `empty`: returns true if `value` is empty (null, undefined, empty string, array/object with no elements) or, if `coalesce` is defined, returns `coalesce` when empty. |
| number\_format | js/func | number, decimals, dec\_point, thousands\_sep | Formats `number` with `decimals` decimal places, decimal separator `dec_point`, and thousands separator `thousands_sep`, rounding correctly. |
| floatval | js/func | number | Converts string `number` (with dot or comma) to float, removing non-numeric characters and replacing the last comma with a dot. |
| floatval\_safe | js/func | number, decimals | Converts `number` to a safe float, filtering invalid characters, replacing commas with dots, and formatting with `decimals` decimal places. |
| savecookie | js/func | key, value, expiry, domain, path | Sets a `key=value` cookie with expiration in days (`expiry`), domain (`domain`), and path (`path`). Returns `value`. |
| delcookie | js/func | key | Removes the `key` cookie by setting a past expiration on domain variations (hostname with and without dot) and default path. Returns true. |
| function\_exists | js/func | function\_name | Checks if `function_name` (string or reference) is a function defined in `window` or a `Function` object. Returns boolean. |
| curlsend | js/func | url, params, success, error, always, timeout, cachectl, reqtype, cors | Sends AJAX GET/POST to `url` with `params`, managing cache (`cachectl`) in localStorage, applying `reqtype` and `cors`. Fires events `${endpoint}_onpoststart` and `_onpostload`, executes `success`, `error`, `always` callbacks, and returns the jqXHR object. |
| http\_build\_query | js/func | obj | Converts the `obj` object into a URL-encoded query string using `URLSearchParams`. |
| date | js/func | stringtxt, unixtimestamp, zone | Formats date/time according to PHP-like tokens (`Y, m, d, H, i, s, P, w, W, D, M`) using Unix timestamp `unixtimestamp` and offset `zone`. |
| empty | js/func | value, coalesce | Emulates PHP's `empty`: returns true for `null`, `undefined`, empty string, array/object with no elements; if `coalesce` is provided, returns `coalesce` instead of true. |
| number\_format | js/func | number, decimals, dec\_point, thousands\_sep | Formats `number` with `decimals` decimal places, decimal separator `dec_point`, and thousands separator `thousands_sep`, rounding correctly. |
| floatval | js/func | number | Converts string `number` (with dot or comma) to float, removing non-numeric characters, replacing the last comma with a dot. |
| floatval\_safe | js/func | number, decimals | Converts `number` to a safe float, removing invalid characters, converting commas to dots, and formatting with `decimals` decimal places. |
| str\_pad | js/func | input, length, padString, type | Pads `input` up to `length` characters with `padString` to the left, right, or both (`type`: 'left', 'right', 'both'). |
| rmA | js/func | string | Removes accents from `string`, mapping accented characters to their unaccented forms. |
| str\_maskmiddle | js/func | input | Masks ~30% of the central alphanumeric characters of `input` with '\*', preserving the ends. |
| strnameinitials | js/func | name | Returns uppercase initials of `name`, using the first letter of the first and last name. |
| distancia | js/func | position1, position2 | Calculates the distance in km between coordinates `position1` and `position2` using the Haversine formula, returning a value with up to 3 decimal places and a comma as decimal separator. |
| loadScript | js/func | url, callback, onerror | Dynamically loads a `<script src=url>` and calls `callback` on load or `onerror` on failure. |
| loadCss | js/func | url, callback | Dynamically loads CSS `<link href=url>` and calls `callback` on load. |
| loadblink | js/func | width, height | Generates an HTML string of a `<div>` block with classes for “load blink” effect, using random or default `width` and `height`. |
| toast | js/func | text, callback, moredetails | Displays a custom toast with `text`, executes `callback` on close, and optional `moredetails` in the secondary alert; accepts the `':close'` command. |
| getcontrastcolor | js/func | hexcolor | Calculates the contrast color (black or white) for the `hexcolor` background based on luminance. |
| getcolorfromstr | js/func | string | Generates a deterministic hexadecimal color (`#xxxxxx`) from a simple hash of the alphanumeric characters in `string`. |
| valida\_cpf\_cnpj | js/func | val | Validates CPF (11 digits) or CNPJ (14 digits) by checking check digits according to the official algorithm. |
| alertpormodal | js/func | text, closebutton, animate | Displays an alert modal with `text`, close button (`closebutton`), and animation (`animate`). Special commands `':close'`, `':isvisible'`, `':ishidden'`. |
| formatar\_cpf\_cnpj | js/func | data | Formats a numeric string as CPF (`000.000.000-00`) or CNPJ (`00.000.000/0000-00`) according to length. |
| brazil\_get\_cep | js/func | el | Queries the ViaCEP API for the value of the input `el` and fills address fields (`logradouro`, `bairro`, `cidade`, `estado`, `numero`) in the form. |
